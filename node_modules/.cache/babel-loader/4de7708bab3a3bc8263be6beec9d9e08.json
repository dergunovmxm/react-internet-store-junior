{"ast":null,"code":"import _regeneratorRuntime from\"C:/react/react-internet-store-junior/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"C:/react/react-internet-store-junior/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"C:/react/react-internet-store-junior/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import axios from'axios';import{useState}from\"react\";import Info from'../Info';import{useCart}from'../../hooks/useCart';import styles from'./Drawer.module.scss';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var delay=function delay(ms){return new Promise(function(resolve){return setTimeout(resolve,ms);});};function Drawer(_ref){var onClose=_ref.onClose,onRemove=_ref.onRemove,_ref$items=_ref.items,items=_ref$items===void 0?[]:_ref$items,opened=_ref.opened;var _useCart=useCart(),cartItems=_useCart.cartItems,setCartItems=_useCart.setCartItems,totalPrice=_useCart.totalPrice;var _useState=useState(null),_useState2=_slicedToArray(_useState,2),orderId=_useState2[0],setOrderId=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),isOrderComplete=_useState4[0],setIsOrderComplete=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),isLoading=_useState6[0],setIsLoading=_useState6[1];var onClickOrder=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var _yield$axios$post,data,i,item;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;setIsLoading(true);_context.next=4;return axios.post('https://63440055b9ab4243cadca972.mockapi.io/orders',{items:cartItems});case 4:_yield$axios$post=_context.sent;data=_yield$axios$post.data;setOrderId(data.id);setIsOrderComplete(true);setCartItems([]);i=0;case 10:if(!(i<cartItems.length)){_context.next=19;break;}item=cartItems[i];_context.next=14;return axios.delete('https://63440055b9ab4243cadca972.mockapi.io/cart/'+item.id);case 14:_context.next=16;return delay(1000);case 16:i++;_context.next=10;break;case 19:_context.next=24;break;case 21:_context.prev=21;_context.t0=_context[\"catch\"](0);alert('Ошибка при создании заказа :(');case 24:setIsLoading(false);case 25:case\"end\":return _context.stop();}}},_callee,null,[[0,21]]);}));return function onClickOrder(){return _ref2.apply(this,arguments);};}();return/*#__PURE__*/_jsx(\"div\",{className:\"\".concat(styles.overlay,\" \").concat(opened?styles.overlayVisible:''),children:/*#__PURE__*/_jsxs(\"div\",{className:styles.drawer,children:[/*#__PURE__*/_jsxs(\"h2\",{className:\"d-flex justify-between mb-30\",children:[\"\\u041A\\u043E\\u0440\\u0437\\u0438\\u043D\\u0430 \",/*#__PURE__*/_jsx(\"img\",{onClick:onClose,className:\"cu-p\",src:\"images/btn-remove.svg\",alt:\"Close\"})]}),items.length>0?/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex flex-column flex\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"items flex\",children:items.map(function(obj){return/*#__PURE__*/_jsxs(\"div\",{className:\"cartItem d-flex align-center mb-20\",children:[/*#__PURE__*/_jsx(\"div\",{style:{backgroundImage:\"url(\".concat(obj.imageUrl,\")\")},className:\"cartItemImg\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"mr-20 flex\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"mb-5\",children:obj.title}),/*#__PURE__*/_jsxs(\"b\",{children:[obj.price,\" \\u0440\\u0443\\u0431.\"]})]}),/*#__PURE__*/_jsx(\"img\",{onClick:function onClick(){return onRemove(obj.id);},className:\"removeBtn\",src:\"images/btn-remove.svg\",alt:\"Remove\"})]},obj.id);})}),/*#__PURE__*/_jsxs(\"div\",{className:\"cartTotalBlock\",children:[/*#__PURE__*/_jsxs(\"ul\",{children:[/*#__PURE__*/_jsxs(\"li\",{children:[/*#__PURE__*/_jsx(\"span\",{children:\"\\u0418\\u0442\\u043E\\u0433\\u043E:\"}),/*#__PURE__*/_jsx(\"div\",{}),/*#__PURE__*/_jsxs(\"b\",{children:[totalPrice,\" \\u0440\\u0443\\u0431. \"]})]}),/*#__PURE__*/_jsxs(\"li\",{children:[/*#__PURE__*/_jsx(\"span\",{children:\"\\u041D\\u0430\\u043B\\u043E\\u0433 5%:\"}),/*#__PURE__*/_jsx(\"div\",{}),/*#__PURE__*/_jsxs(\"b\",{children:[totalPrice/100*5,\" \\u0440\\u0443\\u0431. \"]})]})]}),/*#__PURE__*/_jsxs(\"button\",{disabled:isLoading,onClick:onClickOrder,className:\"greenButton\",children:[\"\\u041E\\u0444\\u043E\\u0440\\u043C\\u0438\\u0442\\u044C \\u0437\\u0430\\u043A\\u0430\\u0437 \",/*#__PURE__*/_jsx(\"img\",{src:\"images/arrow.svg\",alt:\"Arrow\"})]})]})]}):/*#__PURE__*/_jsx(Info,{title:isOrderComplete?'Заказ оформлен!':'Корзина пустая',description:isOrderComplete?\"\\u0412\\u0430\\u0448 \\u0437\\u0430\\u043A\\u0430\\u0437 #\".concat(orderId,\" \\u0441\\u043A\\u043E\\u0440\\u043E \\u0431\\u0443\\u0434\\u0435\\u0442 \\u043F\\u0435\\u0440\\u0435\\u0434\\u0430\\u043D \\u043A\\u0443\\u0440\\u044C\\u0435\\u0440\\u0441\\u043A\\u043E\\u0439 \\u0434\\u043E\\u0441\\u0442\\u0430\\u0432\\u043A\\u0435\"):'Добавьте хотя бы одну пару кроссовок, чтобы сделать заказ.',image:isOrderComplete?'images/order.svg':'images/cart-empty.svg'})]})});}export default Drawer;","map":{"version":3,"names":["axios","useState","Info","useCart","styles","delay","ms","Promise","resolve","setTimeout","Drawer","onClose","onRemove","items","opened","cartItems","setCartItems","totalPrice","orderId","setOrderId","isOrderComplete","setIsOrderComplete","isLoading","setIsLoading","onClickOrder","post","data","id","i","length","item","delete","alert","overlay","overlayVisible","drawer","map","obj","backgroundImage","imageUrl","title","price"],"sources":["C:/react/react-internet-store-junior/src/components/Drawer/Drawer.js"],"sourcesContent":["import axios from 'axios';\r\nimport { useState } from \"react\";\r\nimport Info from '../Info';\r\nimport { useCart } from '../../hooks/useCart';\r\n\r\nimport styles from './Drawer.module.scss';\r\n\r\nconst delay = (ms) => new Promise((resolve) => setTimeout(resolve, ms));\r\n\r\nfunction Drawer({ onClose, onRemove, items = [], opened }) {\r\n    const { cartItems, setCartItems, totalPrice } = useCart();\r\n    const [orderId, setOrderId] = useState(null);\r\n    const [isOrderComplete, setIsOrderComplete] = useState(false);\r\n    const [isLoading, setIsLoading] = useState(false);\r\n\r\n    const onClickOrder = async () => {\r\n        try {\r\n            setIsLoading(true);\r\n            const { data } = await axios.post('https://63440055b9ab4243cadca972.mockapi.io/orders', {\r\n                items: cartItems,\r\n            });\r\n            setOrderId(data.id);\r\n            setIsOrderComplete(true);\r\n            setCartItems([]);\r\n\r\n            for (let i = 0; i < cartItems.length; i++) {\r\n                const item = cartItems[i];\r\n                await axios.delete('https://63440055b9ab4243cadca972.mockapi.io/cart/' + item.id);\r\n                await delay(1000);\r\n            }\r\n        } catch (error) {\r\n            alert('Ошибка при создании заказа :(');\r\n        }\r\n        setIsLoading(false);\r\n    };\r\n\r\n    return (\r\n        <div className={`${styles.overlay} ${opened ? styles.overlayVisible : ''}`}>\r\n            <div className={styles.drawer}>\r\n                <h2 className=\"d-flex justify-between mb-30\">\r\n                    Корзина <img onClick={onClose} className=\"cu-p\" src=\"images/btn-remove.svg\" alt=\"Close\" />\r\n                </h2>\r\n\r\n                {items.length > 0 ? (\r\n                    <div className=\"d-flex flex-column flex\">\r\n                        <div className=\"items flex\">\r\n                            {items.map((obj) => (\r\n                                <div key={obj.id} className=\"cartItem d-flex align-center mb-20\">\r\n                                    <div\r\n                                        style={{ backgroundImage: `url(${obj.imageUrl})` }}\r\n                                        className=\"cartItemImg\"></div>\r\n\r\n                                    <div className=\"mr-20 flex\">\r\n                                        <p className=\"mb-5\">{obj.title}</p>\r\n                                        <b>{obj.price} руб.</b>\r\n                                    </div>\r\n                                    <img\r\n                                        onClick={() => onRemove(obj.id)}\r\n                                        className=\"removeBtn\"\r\n                                        src=\"images/btn-remove.svg\"\r\n                                        alt=\"Remove\"\r\n                                    />\r\n                                </div>\r\n                            ))}\r\n                        </div>\r\n                        <div className=\"cartTotalBlock\">\r\n                            <ul>\r\n                                <li>\r\n                                    <span>Итого:</span>\r\n                                    <div></div>\r\n                                    <b>{totalPrice} руб. </b>\r\n                                </li>\r\n                                <li>\r\n                                    <span>Налог 5%:</span>\r\n                                    <div></div>\r\n                                    <b>{(totalPrice / 100) * 5} руб. </b>\r\n                                </li>\r\n                            </ul>\r\n                            <button disabled={isLoading} onClick={onClickOrder} className=\"greenButton\">\r\n                                Оформить заказ <img src=\"images/arrow.svg\" alt=\"Arrow\" />\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                ) : (\r\n                    <Info\r\n                        title={isOrderComplete ? 'Заказ оформлен!' : 'Корзина пустая'}\r\n                        description={\r\n                            isOrderComplete\r\n                                ? `Ваш заказ #${orderId} скоро будет передан курьерской доставке`\r\n                                : 'Добавьте хотя бы одну пару кроссовок, чтобы сделать заказ.'\r\n                        }\r\n                        image={isOrderComplete ? 'images/order.svg' : 'images/cart-empty.svg'}\r\n                    />\r\n                )}\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default Drawer;"],"mappings":"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"},"metadata":{},"sourceType":"module"}